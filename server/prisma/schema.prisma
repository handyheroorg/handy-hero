generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CLIENT
  SERVICE_PROVIDER
}

enum ChatStatus {
  IN_PROGRESS
  CLOSED
}

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  fullName     String
  email        String  @unique
  mobileNumber String
  country      String
  avatar       String?
  role         Role
  password     String

  location Location?
  // Each SERVICE_PROVIDER will have their own profile
  profile  ServiceProviderProfile?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  user   User   @relation(fields: [userId], references: [id])
  userId String @unique @db.ObjectId

  latitude  Float
  longitude Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ExperienceLevel {
  ENTRY
  INTERMEDIATE
  EXPERT
}

model ServiceProviderProfile {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique @db.ObjectId

  occupation      String?
  about           String?
  fullAddress     String?
  languages       String[]         @default([])
  education       Json[]           @default([])
  skills          Json[]           @default([])
  experienceLevel ExperienceLevel?
  experiences     Json[]           @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

  model ChatRoom {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    userId          String     @unique @db.ObjectId
    serviceProvider String     @unique @db.ObjectId
    messages        Message[] 
    status          ChatStatus
  }

model Message {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  chatRoomId String   @unique @db.ObjectId

  content String
  seen    Boolean

  createdAt DateTime @default(now())
}